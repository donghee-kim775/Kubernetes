## 쿠버네티스 구조

![image](https://user-images.githubusercontent.com/54052704/224246276-7a2c349e-da4b-4c6f-b82a-dfbed89f6350.png)

쿠버네티스는 클러스터 형태로 구성
> 클러스터? 컨테이너를 실행하는 노드들의 집합 (최소 1개의 워커노드, 최소 1개의 마스터 노드)

### 마스터 노드
1. 워커 노드 및 클러스터 내의 컴포넌트들을 관리

2. __파드__ 를 관리
> 파드? 각각의 컴포넌트들은 어플리케이션 실행단위


- 구성
  - kube-api-server
  - etcd
  - kube-schduler
  - kube-controller-manager



### 워커 노드
1. 파드를 호스트(컴퓨터를 연결)하는 역할

2. 동작죽인 파드를 유지하는 역할

- 구성
  - kubelet
  - kube-proxy

---

## 오브젝트와 컨트롤러

> 쿠버네티스는 크게 1. 오브젝트와 2. 컨트롤러 나누어진다.

### 1.Object(객체)

> 사용자가 바라는 상태(desired state)

- 종류
  - __Pod__ : 쿠버네티스의 기본 실행 / 배포 단위
  - __Service__ : 생성한 파드를 외부에서 접근하게 해주는 오브젝트(엔드 포인트, 로드밸런싱과 정의된 IP를 묶어 서비스를 제공)
  - __Volume__ : 파드가 실행될 때 사용하는 스토리지 -> 각 컨테이너들의 외장 디스크
  - __Name Space__ : 논리적으로 분리된 작업 그룹
  - ....

### 2. Controller(컨트롤러)

> 객체가 원래 설정된 상태를 잘 유지할 수 있게 관리하는 역할

> 탄력적인 운영에 필요한 스케일링, 롤아웃, 롤백, 롤링 업데이트 등의 일을 함

- 종류
  - __ReplicatSet__ : __지정된 수__ 의 파드가 항상 실행되도록 유지
  - __Deployment(권장)__ : __가장 기본적인 컨트롤러__, Deployment생성시 Replica의 수대로 파드가 생성 -> 이것을 관리 할때 도 ReplicaSet 생성
  - __StatefulSet__ : 상태를 가지고 있는 파드들을 관리하는 컨트롤러, 파드는 순서대로 실행, 삭제는 역순으로 진행(순서없이 실행도 가능)
  - __DaemonSet__ : 데몬 프로세서로 띄워야 할 앱이 있을 경우(노드에 단 하나의 파드를 실행, 노드 죽으면 사라짐) -> __모니터링 관련 프로세스__ 가 필요한 경우
  - __Job__ : 하나 이상의 파드가 요청된 작업을 실행한후 정상적으로 종료 하였는지 관리하는 컨트롤러 -> __한 번만 실행하는 작업__ 에 적합(도커이미지 만들기, 머신러닝 학습)

---
-> 쿠버네티스 클러스터에 객체나 컨트롤러가 어떤 상태여야 하는지를 제출할 때는 yaml 파일형식의 템플릿을 사용한다.

쿠버네티스를 설치하게 되면 쿠버네티스 운영을 위한 네임 스페이스들을 생성하게 되는데 아래와 같다.

- __default__ : 기본 네임스페이스, 사용자가 명령을 실행할 때 특정 네임스페이스를 __지정하지 않는다면 여기서 실행__

- __kube-system__ : 쿠버네티스 관리용 파드, 설정이 있는 네임스페이스, (etcd, api-server, proxy, coredns, 네트워크 플러그인, GPU플러그인 등 존재)

- __kube-public__ : 쿠버네티스 클러스터 내의 __모든 사용자(인정되지 않은 사용자 포함)__ 가 접근할 수 있는 네임스페이스, 전체 공유해야 할 서비스 파드 같은 오브젝트 여기 해당

- __kube-node-lease__ : 1.13이후로 추가된 네임스페이스, 노드의 임대오브젝트들을 관리

-> 물론 쿠베플로우를 설치하게 되면 kubeflow라는 이름으로 네임스페이스 생성(각종 파드, 서비스 등 오브젝트들 설치)

---

## 오브젝트 템플릿

쿠버네티스에서 사용자가 오브젝트 다루는 방법

1. __kube-api-server__ 에 API Request로 요청하는 방법
> JSON형태의 리퀘스트 바디를 작성하여 마스터 노드의 __6443 port__ (외부에서 접근할 수 있는 기본포트)로 API Request 요청

-> 이것은 별도의 클라이언트를 구성하지 않는다면 관리 불편

2. __kubectl__ 이라는 커맨드 라인툴 이용
> 대부분의 사용자들은 쿠버네티스에서 정의한 템플릿으로 .yaml 타입의 파일을 작성 후 커맨드-라인 툴을 이용

-> kubectl은 이 .yaml을 JSON형태로 변환 kube-api-server에 API 리퀘스트 요청
